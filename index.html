<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Java SProc Wrapper by Zalando</title>
    <link type="image/x-icon" href="images/favico.png" rel="icon">
    <link rel="canonical" href="http://zalando.github.io/java-sproc-wrapper">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="template/templatescripts.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-40533395-4', 'zalando.github.io');
        ga('send', 'pageview');
    </script>
</head>
<body>
    <div id="wrapper">
        <div id="menu-wrapper"></div>

        <div id="page">

            <div class="inner">
                <h1>Java SProc Wrapper</h1>
            </div>

            <div id="topfacts" class="inner">
                <h3>The ultimate PostgreSQL stored procedure wrapper for Java!</h3>
            </div>

            <div class="inner">
                <p>
                    This is a library to make PostgreSQL stored procedures(SProcs) available through simple
                    Java "SProcService" interfaces including automatic object serialization and deserialization
                    (using typemapper and convention-over-configuration).
                </p>
                <p>
                    Supports horizontal database sharding (partition/access logic lies within application),
                    easy use of pg_advisory_lock through annotations to ensure single Java node
                    execution, configurable statement timeouts per stored procedure, and PostgreSQL
                    types including enums and hstore.
                </p>
            </div>

            <div class="inner">
                Consider a basic example to load a customer from the database by its id field. In that case we consider the customer class to contain another object for the customer's address.
            </div>
            <div class="inner">
<div style="float:left;width:33%;">
<pre class="brush: java">
class Customer {

    @DatabaseField
    private int id;

    @DatabaseField
    private String name;

    @DatabaseField
    private String firstName;

    @DatabaseField
    private Address address
}
</pre>
</div>
<div style="width:33%">
 <pre class="brush: java">
class Address {
    @DatabaseField
    private String street;

    @DatabaseField
    private int number;

    @DatabaseField
    private int zip;

    @DatabaseField
    private String city;
}
</pre>
</div>
</div>
<div class="inner">
Let's now define the interface for the sproc wrapper, that reflects the signature of the PostgreSQL stored procedure.
 <pre class="brush: java">
@SProcService
interface CustomerService {
    
    @SProcCall
    Customer getCustomerForId(@SProcParam int id);
}
</pre>

            <pre class="brush: sql">
CREATE FUNCTION get_customer_for_id(p_id int) RETURNS customer
$$
SELECT id,name,first_name,
       (SELECT (street, number, zip, city) 
          FROM customer_address a
         WHERE a.id = c.id AND a.ca_is_default) address
  FROM customer c
 WHERE id = p_id
$$ LANGUAGE 'sql';
            </pre>
            </div>

            <div class="inner">
                <h4>Dependencies</h4>
                <ul>
                    <li>PostgreSQL driver :-)</li>
                    <li>Spring Framework</li>
                    <li>Google Guava</li>
                    <li>More, see pom.xml for details...</li>
                </ul>
            </div>

            <div class="inner">
                <h4>How to run integration tests</h4>
                <ul>
                    <li>Install local PostgreSQL cluster running on 5432.</li>
                    <li>Allow connection with postgres/postgres...<br />
                        or create a new user and set config values in pom.xml and application.test.properties.</li>
                    <li>Create schema and database privileges required for test cases.</li>
                    <li>Make sure you have hstore extension installed, preferably in template1.</li>
                    <li>Create zalando_test database on your localhost PostgreSQL cluster...<br />
                        and possibly add hstore extension to database.</li>
                    <li>Run integration tests (JUnit tests with database access): mvn clean test -Pintegration-test.</li>
                </ul>
            </div>

        </div>

        <a id="fork" href="https://github.com/zalando/java-sproc-wrapper/fork" title="Fork Java SProc Wrapper on GitHub"></a>

        <div id="footer-notes">
            <div class="inner">
                <code class="right">
                    $ git clone git@github.com:zalando/java-sproc-wrapper
                </code>
                <h3>
                    Open Source
                </h3>
                <div>
                    The Java SProc Wrapper is one of our java/postgres tools developed and used by Zalando's technology team.
                    We want to share it with you. Go grab it, it's free to use, to share, and to hack!
                </div>
            </div>
        </div>

        <div id="footer-wrapper"></div>
    </div>
</body>
</html>